var c=class{constructor(t){this.cache=new Map;this.pending=new Map;this.ttl=t}async fetch(t,i){let n=this.cache.get(t);if(n&&+new Date-n.timestamp<this.ttl)return n.data;let e=this.pending.get(t);if(e)return e;let r=i();return this.pending.set(t,r),r.then(a=>(this.pending.delete(t),this.cache.set(t,{data:a,timestamp:Date.now()}),a)).catch(a=>{throw this.pending.delete(t),a})}clear(){this.cache=new Map,this.pending=new Map}};(async()=>{let s=new c(1e3),t=await Promise.all([s.fetch("/api/users/1",()=>fetch("/api/users/1").then(e=>e.json())),s.fetch("/api/users/1",()=>fetch("/api/users/1").then(e=>e.json()))]);console.log(t);let i=await s.fetch("/api/users/1",()=>fetch("/api/users/1").then(e=>e.json()));console.log(i),await new Promise(e=>setTimeout(e,1500));let n=await s.fetch("/api/users/1",()=>fetch("/api/users/1").then(e=>e.json()));console.log(n)})();
//# sourceMappingURL=script.js.map
