{
  "version": 3,
  "sources": ["../../../../static/root/gym/3/3.3/script.ts"],
  "sourcesContent": ["// @process\nexport {};\n\nclass APICache {\n  cache: Map<string, { data: any; timestamp: number }> = new Map<\n    string,\n    { data: any; timestamp: number }\n  >();\n\n  pending: Map<string, Promise<any>> = new Map<string, Promise<any>>();\n\n  ttl: number; // time to live \u0432 \u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430\u0445\n\n  constructor(ttl: number) {\n    this.ttl = ttl;\n  }\n\n  async fetch<T>(url: string, fetcher: () => Promise<T>): Promise<T> {\n    // \u0415\u0441\u043B\u0438 \u0434\u0430\u043D\u043D\u044B\u0435 \u0432 \u043A\u044D\u0448\u0435 \u0438 \u043D\u0435 \u0438\u0441\u0442\u0435\u043A\u043B\u0438 - \u0432\u0435\u0440\u043D\u0443\u0442\u044C \u0438\u0437 \u043A\u044D\u0448\u0430\n    // \u0418\u043D\u0430\u0447\u0435 - \u0432\u044B\u043F\u043E\u043B\u043D\u0438\u0442\u044C fetcher, \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0432 \u043A\u044D\u0448, \u0432\u0435\u0440\u043D\u0443\u0442\u044C\n\n    const cacheVal = this.cache.get(url);\n    if (cacheVal && +new Date() - cacheVal.timestamp < this.ttl) {\n      return cacheVal.data;\n    }\n\n    const pendingReq = this.pending.get(url);\n    if (pendingReq) {\n      return pendingReq;\n    }\n\n    const promise = fetcher();\n    this.pending.set(url, promise);\n\n    return promise\n      .then((data) => {\n        this.pending.delete(url);\n        this.cache.set(url, {\n          data,\n          timestamp: Date.now(),\n        });\n        return data;\n      })\n      .catch((e) => {\n        this.pending.delete(url);\n        throw e;\n      });\n  }\n\n  clear(): void {\n    this.cache = new Map<string, { data: any; timestamp: number }>();\n    this.pending = new Map<string, Promise<any>>();\n  }\n}\n\n(async () => {\n  // \u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0435:\n  const cache = new APICache(1000); // 1 \u043C\u0438\u043D\u0443\u0442\u0430\n\n  const d = await Promise.all([\n    cache.fetch('/api/users/1', () =>\n      fetch('/api/users/1').then((r) => r.json()),\n    ),\n    cache.fetch('/api/users/1', () =>\n      fetch('/api/users/1').then((r) => r.json()),\n    ),\n  ]);\n\n  console.log(d);\n\n  const data1 = await cache.fetch('/api/users/1', () =>\n    fetch('/api/users/1').then((r) => r.json()),\n  );\n  console.log(data1);\n\n  await new Promise((r) => setTimeout(r, 1500));\n\n  const data2 = await cache.fetch('/api/users/1', () =>\n    fetch('/api/users/1').then((r) => r.json()),\n  );\n  console.log(data2);\n})();\n"],
  "mappings": "AAGA,IAAMA,EAAN,KAAe,CAUb,YAAYC,EAAa,CATzB,WAAuD,IAAI,IAK3D,aAAqC,IAAI,IAKvC,KAAK,IAAMA,CACb,CAEA,MAAM,MAASC,EAAaC,EAAuC,CAIjE,IAAMC,EAAW,KAAK,MAAM,IAAIF,CAAG,EACnC,GAAIE,GAAY,CAAC,IAAI,KAASA,EAAS,UAAY,KAAK,IACtD,OAAOA,EAAS,KAGlB,IAAMC,EAAa,KAAK,QAAQ,IAAIH,CAAG,EACvC,GAAIG,EACF,OAAOA,EAGT,IAAMC,EAAUH,EAAQ,EACxB,YAAK,QAAQ,IAAID,EAAKI,CAAO,EAEtBA,EACJ,KAAMC,IACL,KAAK,QAAQ,OAAOL,CAAG,EACvB,KAAK,MAAM,IAAIA,EAAK,CAClB,KAAAK,EACA,UAAW,KAAK,IAAI,CACtB,CAAC,EACMA,EACR,EACA,MAAOC,GAAM,CACZ,WAAK,QAAQ,OAAON,CAAG,EACjBM,CACR,CAAC,CACL,CAEA,OAAc,CACZ,KAAK,MAAQ,IAAI,IACjB,KAAK,QAAU,IAAI,GACrB,CACF,GAEC,SAAY,CAEX,IAAMC,EAAQ,IAAIT,EAAS,GAAI,EAEzBU,EAAI,MAAM,QAAQ,IAAI,CAC1BD,EAAM,MAAM,eAAgB,IAC1B,MAAM,cAAc,EAAE,KAAME,GAAMA,EAAE,KAAK,CAAC,CAC5C,EACAF,EAAM,MAAM,eAAgB,IAC1B,MAAM,cAAc,EAAE,KAAME,GAAMA,EAAE,KAAK,CAAC,CAC5C,CACF,CAAC,EAED,QAAQ,IAAID,CAAC,EAEb,IAAME,EAAQ,MAAMH,EAAM,MAAM,eAAgB,IAC9C,MAAM,cAAc,EAAE,KAAME,GAAMA,EAAE,KAAK,CAAC,CAC5C,EACA,QAAQ,IAAIC,CAAK,EAEjB,MAAM,IAAI,QAASD,GAAM,WAAWA,EAAG,IAAI,CAAC,EAE5C,IAAME,EAAQ,MAAMJ,EAAM,MAAM,eAAgB,IAC9C,MAAM,cAAc,EAAE,KAAME,GAAMA,EAAE,KAAK,CAAC,CAC5C,EACA,QAAQ,IAAIE,CAAK,CACnB,GAAG",
  "names": ["APICache", "ttl", "url", "fetcher", "cacheVal", "pendingReq", "promise", "data", "e", "cache", "d", "r", "data1", "data2"]
}
