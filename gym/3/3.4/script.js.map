{
  "version": 3,
  "sources": ["../../../../static/root/gym/3/3.4/script.ts"],
  "sourcesContent": ["// @process\nexport {};\n\nclass InfiniteScroll {\n  page: number;\n  loading: boolean;\n  hasMore: boolean;\n  items: any[];\n  limit = 56;\n\n  constructor() {\n    this.page = 0;\n    this.loading = false;\n    this.hasMore = true;\n    this.items = [];\n  }\n\n  async loadMore(): Promise<void> {\n    if (this.loading || !this.hasMore) {\n      return;\n    }\n\n    this.page++;\n    this.loading = true;\n\n    try {\n      const res = await fetch(\n        `/api/items?page=${this.page}&limit=${this.limit}`,\n      );\n      if (!res.ok) {\n        throw new Error(`Error with status ${res.status}`);\n      }\n      const data = (await res.json()) as any[];\n\n      this.items.push(...data);\n      if (data.length < this.limit) {\n        this.hasMore = false;\n      }\n    } catch (e) {\n      this.page--;\n      throw e;\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  reset(): void {\n    this.page = 0;\n    this.loading = false;\n    this.hasMore = true;\n    this.items = [];\n    // \u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C \u043A \u043F\u0435\u0440\u0432\u043E\u0439 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435\n  }\n}\n\nconst sentinel = document.querySelector('#sentinel')!;\nconst dataRows = document.querySelector('#rows')!;\nconst dataContainer = document.querySelector('#data')!;\n\nconst storage = new InfiniteScroll();\n\ndocument.querySelector('#reset')?.addEventListener('click', () => {\n  storage.reset();\n  dataRows.innerHTML = '';\n});\n\nfunction isSentinelVisible(): boolean {\n  const rect = sentinel.getBoundingClientRect();\n  const containerRect = dataContainer.getBoundingClientRect();\n\n  return rect.top < containerRect.bottom;\n}\n\nvoid (async () => {\n  // \u041D\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u043C \u043D\u0430\u0431\u043B\u044E\u0434\u0430\u0442\u0435\u043B\u044C\n  const observer = new IntersectionObserver(\n    (entries) => {\n      entries.forEach((entry) => {\n        // \u041A\u043E\u0433\u0434\u0430 \u044D\u043B\u0435\u043C\u0435\u043D\u0442 \u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u0441\u044F \u0432\u0438\u0434\u0438\u043C\u044B\u043C\n        if (entry.isIntersecting) {\n          console.log('\u0414\u043E\u0441\u0442\u0438\u0433\u043D\u0443\u0442 \u043A\u043E\u043D\u0435\u0446 \u0441\u043F\u0438\u0441\u043A\u0430!');\n          (async () => {\n            await storage.loadMore();\n            dataRows.innerHTML = '';\n            storage.items.forEach((item) => {\n              const rowEl = document.createElement('div');\n              rowEl.className = 'row';\n              rowEl.innerText = `ID: ${item.id}`;\n              dataRows.append(rowEl);\n            });\n\n            // \u26A0\uFE0F \u0420\u0435\u043A\u0443\u0440\u0441\u0438\u0432\u043D\u0430\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0435\u0441\u043B\u0438 sentinel \u0432\u0441\u0451 \u0435\u0449\u0451 \u0432\u0438\u0434\u0435\u043D\n            if (isSentinelVisible() && storage.hasMore && !storage.loading) {\n              console.log('\uD83D\uDD01 Sentinel \u0432\u0438\u0434\u0435\u043D, \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u0435\u0449\u0451...');\n              // \u0422\u0440\u0438\u0433\u0433\u0435\u0440\u0438\u043C observer \u0441\u043D\u043E\u0432\u0430\n              observer.unobserve(sentinel);\n              observer.observe(sentinel);\n            }\n          })();\n        }\n      });\n    },\n    {\n      root: dataContainer, // viewport \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\n      rootMargin: '0px',\n      threshold: 0.1, // \u0441\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0435\u0442 \u043F\u0440\u0438 10% \u0432\u0438\u0434\u0438\u043C\u043E\u0441\u0442\u0438\n    },\n  );\n\n  // \u041D\u0430\u0447\u0438\u043D\u0430\u0435\u043C \u043D\u0430\u0431\u043B\u044E\u0434\u0435\u043D\u0438\u0435\n  observer.observe(sentinel);\n})();\n\n// API: GET /api/items?page=1&limit=20\n"],
  "mappings": "AAGA,IAAMA,EAAN,KAAqB,CAOnB,aAAc,CAFd,WAAQ,GAGN,KAAK,KAAO,EACZ,KAAK,QAAU,GACf,KAAK,QAAU,GACf,KAAK,MAAQ,CAAC,CAChB,CAEA,MAAM,UAA0B,CAC9B,GAAI,OAAK,SAAW,CAAC,KAAK,SAI1B,MAAK,OACL,KAAK,QAAU,GAEf,GAAI,CACF,IAAMC,EAAM,MAAM,MAChB,mBAAmB,KAAK,cAAc,KAAK,OAC7C,EACA,GAAI,CAACA,EAAI,GACP,MAAM,IAAI,MAAM,qBAAqBA,EAAI,QAAQ,EAEnD,IAAMC,EAAQ,MAAMD,EAAI,KAAK,EAE7B,KAAK,MAAM,KAAK,GAAGC,CAAI,EACnBA,EAAK,OAAS,KAAK,QACrB,KAAK,QAAU,GAEnB,OAAS,EAAP,CACA,WAAK,OACC,CACR,QAAE,CACA,KAAK,QAAU,EACjB,EACF,CAEA,OAAc,CACZ,KAAK,KAAO,EACZ,KAAK,QAAU,GACf,KAAK,QAAU,GACf,KAAK,MAAQ,CAAC,CAEhB,CACF,EAEMC,EAAW,SAAS,cAAc,WAAW,EAC7CC,EAAW,SAAS,cAAc,OAAO,EACzCC,EAAgB,SAAS,cAAc,OAAO,EAE9CC,EAAU,IAAIN,EA3DpBO,GA6DAA,EAAA,SAAS,cAAc,QAAQ,IAA/B,MAAAA,EAAkC,iBAAiB,QAAS,IAAM,CAChED,EAAQ,MAAM,EACdF,EAAS,UAAY,EACvB,GAEA,SAASI,GAA6B,CACpC,IAAMC,EAAON,EAAS,sBAAsB,EACtCO,EAAgBL,EAAc,sBAAsB,EAE1D,OAAOI,EAAK,IAAMC,EAAc,MAClC,EAEM,SAAY,CAEhB,IAAMC,EAAW,IAAI,qBAClBC,GAAY,CACXA,EAAQ,QAASC,GAAU,CAErBA,EAAM,iBACR,QAAQ,IAAI,6HAAyB,GACpC,UACC,MAAMP,EAAQ,SAAS,EACvBF,EAAS,UAAY,GACrBE,EAAQ,MAAM,QAASQ,GAAS,CAC9B,IAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,MAClBA,EAAM,UAAY,OAAOD,EAAK,KAC9BV,EAAS,OAAOW,CAAK,CACvB,CAAC,EAGGP,EAAkB,GAAKF,EAAQ,SAAW,CAACA,EAAQ,UACrD,QAAQ,IAAI,iIAAqC,EAEjDK,EAAS,UAAUR,CAAQ,EAC3BQ,EAAS,QAAQR,CAAQ,KAE1B,EAEP,CAAC,CACH,EACA,CACE,KAAME,EACN,WAAY,MACZ,UAAW,EACb,CACF,EAGAM,EAAS,QAAQR,CAAQ,CAC3B,GAAG",
  "names": ["InfiniteScroll", "res", "data", "sentinel", "dataRows", "dataContainer", "storage", "_a", "isSentinelVisible", "rect", "containerRect", "observer", "entries", "entry", "item", "rowEl"]
}
