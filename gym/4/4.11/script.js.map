{
  "version": 3,
  "sources": ["../../../../static/root/gym/4/4.11/script.ts"],
  "sourcesContent": ["// @process\nexport {};\n\nclass VirtualScroll<T> {\n  container: HTMLElement;\n  items: T[];\n  itemHeight: number;\n  renderItem: (item: T) => string;\n  inner: HTMLElement;\n\n  innerChildNodes = new Map<number, HTMLElement>();\n\n  constructor(\n    container: HTMLElement,\n    items: T[],\n    itemHeight: number,\n    renderItem: (item: T) => string,\n  ) {\n    this.container = container;\n    this.items = items;\n    this.itemHeight = itemHeight;\n    this.renderItem = renderItem;\n\n    const inner = document.createElement('div');\n    this.inner = inner;\n    //inner.style.contain = 'layout style paint';\n    inner.style.height = `${this.items.length * this.itemHeight}px`;\n    inner.style.position = 'relative';\n\n    this.container.append(inner);\n\n    let rafId: number | null = null;\n    container.addEventListener(\n      'scroll',\n      () => {\n        if (rafId) return; // \u041F\u0440\u043E\u043F\u0443\u0441\u043A\u0430\u0435\u043C \u0435\u0441\u043B\u0438 \u0443\u0436\u0435 \u0437\u0430\u043F\u043B\u0430\u043D\u0438\u0440\u043E\u0432\u0430\u043D\n        rafId = requestAnimationFrame(() => {\n          this.render();\n          rafId = null;\n        });\n      },\n      { passive: true },\n    );\n    this.render();\n  }\n\n  createItemEl(i: number) {\n    const itemHtml = this.renderItem(this.items[i]);\n    const template = document.createElement('template');\n    template.innerHTML = itemHtml.trim();\n    const el = template.content.firstElementChild! as HTMLElement;\n\n    el.style.position = 'absolute';\n    el.style.width = '100%';\n    el.style.transform = `translateY(${i * this.itemHeight}px)`;\n\n    return el;\n  }\n\n  render(): void {\n    const BUFFER = 5;\n\n    let startItems = Math.floor(this.container.scrollTop / this.itemHeight);\n    let endItems =\n      startItems + Math.ceil(this.container.offsetHeight / this.itemHeight);\n\n    startItems = Math.max(0, startItems - BUFFER);\n    endItems = Math.min(endItems + BUFFER, this.items.length);\n\n    // \u0423\u0434\u0430\u043B\u044F\u0435\u043C \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0432\u043D\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D\u0430\n    this.innerChildNodes.forEach((child, idx) => {\n      if (idx < startItems || idx >= endItems) {\n        child.remove();\n        this.innerChildNodes.delete(idx);\n      }\n    });\n\n    // \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u043D\u043E\u0432\u044B\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B\n    const fragment = document.createDocumentFragment();\n    for (let i = startItems; i < endItems; i++) {\n      if (!this.innerChildNodes.has(i)) {\n        const el = this.createItemEl(i);\n        this.innerChildNodes.set(i, el);\n        fragment.appendChild(el);\n      }\n    }\n\n    if (fragment.hasChildNodes()) {\n      this.inner.appendChild(fragment);\n    }\n  }\n}\n\n// items = Array(10000).fill(0).map((_, i) => ({ id: i, name: `Item ${i}` }))\n// \u0414\u043E\u043B\u0436\u043D\u044B \u0431\u044B\u0442\u044C \u0432\u0438\u0434\u043D\u044B \u0442\u043E\u043B\u044C\u043A\u043E ~20 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u043E\u0432 \u043E\u0434\u043D\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E\n\nconst listEl: HTMLElement = document.querySelector('#list')!;\n\nconst items = new Array(1000)\n  .fill(0)\n  .map((_, idx) => ({ id: idx, title: `Row_${idx}` }));\n\nnew VirtualScroll(listEl, items, 40, (item: { id: number; title: string }) => {\n  return `<div style='height: 40px;' class='row'>${item.title}</div>`;\n});\n"],
  "mappings": "AAGA,IAAMA,EAAN,KAAuB,CASrB,YACEC,EACAC,EACAC,EACAC,EACA,CAPF,qBAAkB,IAAI,IAQpB,KAAK,UAAYH,EACjB,KAAK,MAAQC,EACb,KAAK,WAAaC,EAClB,KAAK,WAAaC,EAElB,IAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1C,KAAK,MAAQA,EAEbA,EAAM,MAAM,OAAS,GAAG,KAAK,MAAM,OAAS,KAAK,eACjDA,EAAM,MAAM,SAAW,WAEvB,KAAK,UAAU,OAAOA,CAAK,EAE3B,IAAIC,EAAuB,KAC3BL,EAAU,iBACR,SACA,IAAM,CACAK,IACJA,EAAQ,sBAAsB,IAAM,CAClC,KAAK,OAAO,EACZA,EAAQ,IACV,CAAC,EACH,EACA,CAAE,QAAS,EAAK,CAClB,EACA,KAAK,OAAO,CACd,CAEA,aAAaC,EAAW,CACtB,IAAMC,EAAW,KAAK,WAAW,KAAK,MAAMD,EAAE,EACxCE,EAAW,SAAS,cAAc,UAAU,EAClDA,EAAS,UAAYD,EAAS,KAAK,EACnC,IAAME,EAAKD,EAAS,QAAQ,kBAE5B,OAAAC,EAAG,MAAM,SAAW,WACpBA,EAAG,MAAM,MAAQ,OACjBA,EAAG,MAAM,UAAY,cAAcH,EAAI,KAAK,gBAErCG,CACT,CAEA,QAAe,CAGb,IAAIC,EAAa,KAAK,MAAM,KAAK,UAAU,UAAY,KAAK,UAAU,EAClEC,EACFD,EAAa,KAAK,KAAK,KAAK,UAAU,aAAe,KAAK,UAAU,EAEtEA,EAAa,KAAK,IAAI,EAAGA,EAAa,CAAM,EAC5CC,EAAW,KAAK,IAAIA,EAAW,EAAQ,KAAK,MAAM,MAAM,EAGxD,KAAK,gBAAgB,QAAQ,CAACC,EAAOC,IAAQ,EACvCA,EAAMH,GAAcG,GAAOF,KAC7BC,EAAM,OAAO,EACb,KAAK,gBAAgB,OAAOC,CAAG,EAEnC,CAAC,EAGD,IAAMC,EAAW,SAAS,uBAAuB,EACjD,QAASR,EAAII,EAAYJ,EAAIK,EAAUL,IACrC,GAAI,CAAC,KAAK,gBAAgB,IAAIA,CAAC,EAAG,CAChC,IAAMG,EAAK,KAAK,aAAaH,CAAC,EAC9B,KAAK,gBAAgB,IAAIA,EAAGG,CAAE,EAC9BK,EAAS,YAAYL,CAAE,CACzB,CAGEK,EAAS,cAAc,GACzB,KAAK,MAAM,YAAYA,CAAQ,CAEnC,CACF,EAKMC,EAAsB,SAAS,cAAc,OAAO,EAEpDd,EAAQ,IAAI,MAAM,GAAI,EACzB,KAAK,CAAC,EACN,IAAI,CAACe,EAAGH,KAAS,CAAE,GAAIA,EAAK,MAAO,OAAOA,GAAM,EAAE,EAErD,IAAId,EAAcgB,EAAQd,EAAO,GAAKgB,GAC7B,0CAA0CA,EAAK,aACvD",
  "names": ["VirtualScroll", "container", "items", "itemHeight", "renderItem", "inner", "rafId", "i", "itemHtml", "template", "el", "startItems", "endItems", "child", "idx", "fragment", "listEl", "_", "item"]
}
