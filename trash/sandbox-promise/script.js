var c=class extends Error{constructor(n){super(n),this.name="CancelError"}};function s(e,n){let t=new XMLHttpRequest,a=new Promise((d,o)=>{t.open(e,n),t.onload=function(){this.status>=200&&this.status<300?d(JSON.parse(t.response)):o(new Error("Response status error"))},t.onerror=function(){o(new Error("Network error"))},t.addEventListener("abort",()=>{o(new c("Canceled"))}),t.send()});return a.cancel=()=>{t.abort()},a}var p=document.querySelector("#input"),w=document.querySelector("#result"),u=e=>{w.innerHTML=e};p.addEventListener("input",e=>{u(e.target.value)});var l;document.querySelector("#start").addEventListener("click",async()=>{l=s("GET","/api/test1.do");let e=await l;u(e.result)});document.querySelector("#stop").addEventListener("click",async()=>{l.cancel()});var i=e=>{let n={req:void 0},t=e(n);return t.cancel=()=>{try{n.req.cancel()}catch(a){}},t},r,y=async()=>{try{r&&r.cancel(),r=i(e=>(async()=>{e.req=s("GET","/api/test1.do");let n=await e.req;e.req=s("GET","/api/test2.do");let t=await e.req;return`cr=${n.result}${t.result}`})()),await r,r=i(e=>(async()=>{e.req=s("GET","/api/test1.do");let n=await e.req;e.req=s("GET","/api/test2.do");let t=await e.req;return`cr=${n.result}${t.result}`})()),await r}catch(e){if(e instanceof c)return console.log("canceled"),123;throw e}};document.querySelector("#start-complex").addEventListener("click",async()=>{try{let e=await y()}catch(e){console.warn(e)}});document.querySelector("#stop-complex").addEventListener("click",async()=>{r.cancel()});
//# sourceMappingURL=script.js.map
