"use strict";(()=>{var E=(t,e,n)=>{let r=t.createShader(e);if(!r)throw new Error("createShader failed");if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(`could not compile shader: ${t.getShaderInfoLog(r)||""}`);return r},R=(t,e,n)=>{let r=t.createProgram();if(!r)throw new Error("createProgram failed");if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(`program failed to link:${t.getProgramInfoLog(r)||""}`);return r},A=t=>{let e=t.createTexture();if(t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),e===null)throw new Error("texture create fail");return e},h=(t,e)=>{t.bindTexture(t.TEXTURE_2D,e);{let r=t.RGBA,c=0,u=t.RGBA,s=t.UNSIGNED_BYTE,T=null;t.texImage2D(t.TEXTURE_2D,0,r,t.canvas.width,t.canvas.height,c,u,s,T)}},x=t=>{let e=t.clientWidth,n=t.clientHeight,r=t.width!==e||t.height!==n;return r&&(t.width=e,t.height=n),r};var l=`#version 300 es
precision highp float;in vec2 v_uv;uniform vec2 u_resolution;uniform float u_time;uniform sampler2D u_image;out vec4 outColor;
#define hue(h) clamp( abs( fract(h + vec4(3,2,1,0)/3.) * 6. - 3.) -1. , 0., 1.)
vec2 rand(vec2 p){return fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);}void main(){vec2 ouv=v_uv;vec2 uv=v_uv-vec2(.5);uv.x*=u_resolution.x/u_resolution.y;vec2 luv=uv;uv*=10.+sin(u_time*.5)*3.;vec2 iuv=floor(uv);vec2 guv=fract(uv);float mDist=1.0;vec3 col=vec3(0.);for(float y=-1.;y<=1.;y++){for(float x=-1.;x<=1.;x++){vec2 neighbor=vec2(x,y);vec2 point=rand(iuv+neighbor);point=0.5+0.5*sin(u_time*2.+6.2831*point);vec2 diff=neighbor+point-guv;float dist=length(diff);mDist=min(mDist,dist);}}float l=length(luv);col=hue(fract(mDist*.95+u_time*.1+l)).rgb;outColor=vec4(col,1.0)*.05+texture(u_image,ouv)*.95;}`;var L=`#version 300 es
precision highp float;in vec2 v_uv;uniform sampler2D u_image;out vec4 outColor;void main(){outColor=texture(u_image,v_uv);}`;var b=`#version 300 es
in vec4 a_position;in vec2 a_uv;uniform float u_time;uniform vec2 u_resolution;out vec2 v_uv;void main(){vec4 pos=a_position;gl_Position=pos;v_uv=a_uv;}`;(()=>{let t=document.querySelector("#canvas");if(!t)throw new Error("no canvas");let e=t.getContext("webgl2");if(!e)throw new Error("no gl context");let n=({positionAttributeLocation:a,uvAttributeLocation:i})=>{let o=e.createVertexArray();e.bindVertexArray(o);let m=new Float32Array([-1,-1,1,-1,1,1,-1,1]);e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);let f=new Float32Array([0,0,1,0,1,1,0,1]);e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,f,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);let v=new Uint16Array([0,1,3,3,1,2]);return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(v),e.STATIC_DRAW),e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),o},r=(()=>{let a=E(e,e.VERTEX_SHADER,b),i=E(e,e.FRAGMENT_SHADER,L),o=R(e,a,i),m=e.getAttribLocation(o,"a_position"),f=e.getAttribLocation(o,"a_uv"),v=e.getUniformLocation(o,"u_time"),d=e.getUniformLocation(o,"u_resolution"),_=e.getUniformLocation(o,"u_image");return{vao:n({positionAttributeLocation:m,uvAttributeLocation:f}),program:o,uniforms:{timeLocation:v,resolutionLocation:d,imageLocation:_}}})(),c=(()=>{let a=E(e,e.VERTEX_SHADER,b),i=E(e,e.FRAGMENT_SHADER,l),o=R(e,a,i),m=e.getAttribLocation(o,"a_position"),f=e.getAttribLocation(o,"a_uv"),v=e.getUniformLocation(o,"u_time"),d=e.getUniformLocation(o,"u_resolution"),_=e.getUniformLocation(o,"u_image");return{vao:n({positionAttributeLocation:m,uvAttributeLocation:f}),program:o,uniforms:{timeLocation:v,resolutionLocation:d,imageLocation:_}}})(),u=A(e),s=A(e),T=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,T);let p=e.COLOR_ATTACHMENT0;e.framebufferTexture2D(e.FRAMEBUFFER,p,e.TEXTURE_2D,s,0);let S=+new Date;(function a(){let i=(+new Date-S)/1e3;x(e.canvas)&&(e.viewport(0,0,e.canvas.width,e.canvas.height),h(e,s),h(e,u)),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,T),e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(c.program),e.uniform1f(c.uniforms.timeLocation,i),e.uniform2fv(c.uniforms.resolutionLocation,[e.canvas.width,e.canvas.height]),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,u),e.uniform1i(c.uniforms.imageLocation,0),e.bindVertexArray(c.vao),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.bindVertexArray(null),e.bindTexture(e.TEXTURE_2D,u),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,t.clientWidth,t.clientHeight,0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(r.program),e.bindVertexArray(r.vao),e.uniform1f(r.uniforms.timeLocation,i),e.uniform2fv(r.uniforms.resolutionLocation,[e.canvas.width,e.canvas.height]),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,s),e.uniform1i(r.uniforms.imageLocation,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.bindVertexArray(null),requestAnimationFrame(a)})()})();})();
